{"version":3,"file":"createResizePanel.js","sourceRoot":"","sources":["createResizePanel.ts"],"names":[],"mappings":"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","sourcesContent":["import { VNode, h, VNodeProperties } from 'maquette/maquette';\nimport { ComposeFactory } from 'dojo-compose/compose';\nimport createDestroyable, { Destroyable } from 'dojo-compose/mixins/createDestroyable';\nimport { Handle } from 'dojo-core/interfaces';\nimport { on } from 'dojo-core/aspect';\nimport WeakMap from 'dojo-core/WeakMap';\nimport createWidget, { Widget, WidgetState, WidgetOptions } from './createWidget';\nimport createParentMixin, { ParentMixin, ParentMixinOptions, Child } from './mixins/createParentMixin';\nimport createRenderableChildrenMixin from './mixins/createRenderableChildrenMixin';\nimport { Projector } from './projector';\n\n/* TODO: Abstract logic to a mixin */\n\nexport interface ResizePanelState extends WidgetState {\n\twidth?: string;\n}\n\nexport interface ResizePanelOptions extends WidgetOptions<ResizePanelState>, ParentMixinOptions<Child> { }\n\nexport interface ResizePanelMixin {\n\ttagNames: {\n\t\thandle: string;\n\t};\n\twidth: string;\n}\n\nexport type ResizePanel = Widget<ResizePanelState> & ParentMixin<Child> & Destroyable & ResizePanelMixin;\n\nexport interface ResizePanelFactory extends ComposeFactory<ResizePanel, ResizePanelOptions> { }\n\nconst resizeNodePropertiesMap = new WeakMap<ResizePanel, VNodeProperties>();\nconst resizingMap = new WeakMap<ResizePanel, { width: number, clientX: number }>();\n\nfunction getProjector(resizePanel: ResizePanel): Projector {\n\tlet child: any = resizePanel;\n\twhile (child.parent) {\n\t\tchild = child.parent;\n\t}\n\treturn <Projector> child;\n}\n\nfunction setResizeListeners(resizePanel: ResizePanel): Handle {\n\n\tlet onmouseupHandle: Handle;\n\tlet onmousemoveHandle: Handle;\n\tlet ontouchendHandle: Handle;\n\tlet ontouchmoveHandle: Handle;\n\n\tfunction onmouseupListener(evt: MouseEvent): boolean {\n\t\tif (resizingMap.get(resizePanel)) {\n\t\t\tevt.preventDefault();\n\t\t\tresizingMap.delete(resizePanel);\n\t\t\tonmousemoveHandle.destroy();\n\t\t\tonmouseupHandle.destroy();\n\t\t\tresizePanel.invalidate();\n\t\t\treturn true;\n\t\t}\n\t}\n\n\tfunction onmousemoveListener(evt: MouseEvent): boolean {\n\t\tconst originalWidth = resizingMap.get(resizePanel);\n\t\tif (originalWidth) {\n\t\t\tevt.preventDefault();\n\t\t\tresizePanel.width = String(originalWidth.width + evt.clientX - originalWidth.clientX) + 'px';\n\t\t\treturn true;\n\t\t}\n\t}\n\n\tfunction onmousedownListener(evt: MouseEvent): boolean {\n\t\tif (!resizingMap.get(resizePanel)) {\n\t\t\tconst projector = getProjector(resizePanel);\n\t\t\tif (projector && projector.document) {\n\t\t\t\tevt.preventDefault();\n\t\t\t\tresizingMap.set(resizePanel, { width: parseInt(resizePanel.width, 10), clientX: evt.clientX });\n\t\t\t\tonmouseupHandle = on(projector.document, 'onmouseup', onmouseupListener);\n\t\t\t\tonmousemoveHandle = on(projector.document, 'onmousemove', onmousemoveListener);\n\t\t\t\tresizePanel.invalidate();\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction ontouchendListener(evt: TouchEvent): boolean {\n\t\tconst originalWidth = resizingMap.get(resizePanel);\n\t\tif (originalWidth) {\n\t\t\tconsole.log('ontouchend');\n\t\t\tevt.preventDefault();\n\t\t\tresizingMap.delete(resizePanel);\n\t\t\tontouchendHandle.destroy();\n\t\t\tontouchmoveHandle.destroy();\n\t\t\tresizePanel.invalidate();\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tfunction ontouchmoveListener(evt: TouchEvent): boolean {\n\t\tconst originalWidth = resizingMap.get(resizePanel);\n\t\tif (originalWidth && evt.touches.length === 1) {\n\t\t\tconsole.log('ontouchmove');\n\t\t\tevt.preventDefault();\n\t\t\tresizePanel.width = String(originalWidth.width + evt.touches[0].clientX - originalWidth.clientX) + 'px';\n\t\t}\n\t\treturn false;\n\t}\n\n\tfunction ontouchstartListener(evt: TouchEvent): boolean {\n\t\tif (evt.touches.length === 1 && !resizingMap.get(resizePanel)) {\n\t\t\tconst projector = getProjector(resizePanel);\n\t\t\tif (projector) {\n\t\t\t\tconsole.log('ontouchstart');\n\t\t\t\tevt.preventDefault();\n\t\t\t\tresizingMap.set(resizePanel, { width: parseInt(resizePanel.width, 10), clientX: evt.touches[0].clientX });\n\t\t\t\tontouchendHandle = projector.on('touchend', ontouchendListener);\n\t\t\t\tontouchmoveHandle = projector.on('touchmove', ontouchmoveListener);\n\t\t\t\tresizePanel.invalidate();\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tconst resizeNodeProperties = resizeNodePropertiesMap.get(resizePanel);\n\tconst onmousedownHandle = on(resizeNodeProperties, 'onmousedown', onmousedownListener);\n\tconst ontouchstartHandle = on(resizeNodeProperties, 'ontouchstart', ontouchstartListener);\n\treturn {\n\t\tdestroy() {\n\t\t\tonmousedownHandle && onmousedownHandle.destroy();\n\t\t\tonmouseupHandle && onmouseupHandle.destroy();\n\t\t\tonmousemoveHandle && onmousemoveHandle.destroy();\n\t\t\tontouchstartHandle && ontouchstartHandle.destroy();\n\t\t}\n\t};\n}\n\nconst createResizePanel: ResizePanelFactory = createWidget\n\t.mixin(createParentMixin)\n\t.mixin(createRenderableChildrenMixin)\n\t.mixin({\n\t\tmixin: <ResizePanelMixin> {\n\t\t\ttagNames: {\n\t\t\t\thandle: 'dojo-resize-handle'\n\t\t\t},\n\t\t\tget width(): string {\n\t\t\t\tconst resizePanel: ResizePanel = this;\n\t\t\t\treturn resizePanel.state && resizePanel.state && resizePanel.state.width;\n\t\t\t},\n\t\t\tset width(value: string) {\n\t\t\t\tconst resizePanel: ResizePanel = this;\n\t\t\t\tresizePanel.setState({ width: value });\n\t\t\t}\n\t\t},\n\t\taspectAdvice: {\n\t\t\tafter: {\n\t\t\t\tgetChildrenNodes(result: (VNode | string)[]): (VNode | string)[] {\n\t\t\t\t\tconst resizePanel: ResizePanel = this;\n\t\t\t\t\tresult.push(h(resizePanel.tagNames.handle, resizeNodePropertiesMap.get(resizePanel)));\n\t\t\t\t\treturn result;\n\t\t\t\t},\n\t\t\t\tgetNodeAttributes(result: VNodeProperties) {\n\t\t\t\t\tconst resizePanel: ResizePanel = this;\n\t\t\t\t\tresult = result || {};\n\t\t\t\t\tresult.styles = result.styles || {};\n\t\t\t\t\tresult.styles['width'] = resizePanel.width || '200px';\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t})\n\t.extend({\n\t\ttagName: 'dojo-panel-resize'\n\t})\n\t.mixin({\n\t\tmixin: createDestroyable,\n\t\tinitialize(instance) {\n\t\t\tresizeNodePropertiesMap.set(instance, {});\n\t\t\tinstance.own(setResizeListeners(instance));\n\t\t}\n\t});\n\nexport default createResizePanel;\n"]}